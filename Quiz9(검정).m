
%1번

%한 회사에서는 땅콩, 호두, 마카다미아 등을 혼합하여 캔으로 판매하고 있는데,
%내용물의 25%가 값비싼 마카다미아라는 표지를 붙이고 있다고 한다. 이 표지가 과대선전일지도 모른다고 생각한 검사자가
%35개의 캔을 임의로 추출하여 마카다미아의 혼합비율을 측정하였다. 이들 측정치들의 평균과 표준편차는 각각 23.5와 3.1로 밝혀졌다.

% --> "표시된 마카다미아의 혼합비율 25%가 과대선전인지 확인"이 목적
% 검정 대상 : 캔의 마카다미아 혼합비율 평균이 표시된 비율(25%)과 유의미하게 다른지 확인.
% 검정 목적 : 표본 평균과 귀무가설에서 가정한 모평균을 비교
% 모분산, 모표준편차가 주어지지 않았으므로, 표본 표준편차(s)값을 사용해야함
% n = 35 이므로 정규분포를 근사할 수 있음. 단일 표본 z검정 사용

% 문제 판단 기준 정리
% 1. 무엇을 검정하려는가? : 표본 평균과 귀무가설 평균을 비교 -> 평균 검정
% 2. 데이터가 어떤 형태인가? : 단일 표본이며 모분산 x -> 단일 표본 검정
% 3. 표본 크기가 충분한가? : n = 35로 충분히 크므로 z검정 사용

% 데이터
n = 35; % 표본 크기
x1 = 23.5; % 표본 평균
x2 = 25; % 귀무가설 평균
s = 3.1; % 표본 표준편차
alpha = 0.05; % 유의 수준

% 검정통계량 (Z) 단일 표본
% z검정 표본 평균과 귀무가설 하의 평균 차이를 표준오차로 나눈 값
% 단일 표본의 평균이 귀무가설에서 가정된 모평균(𝜇0)과 다른지 검정할 때 사용
% s / sqrt(n) : 표준오차
z = (x1 - x2) / (s / sqrt(n));
z

% P-value 계산 양측 검정이니 2배 z통계량
p_value = 2 * normcdf(z, 0, 1); % P(Z <= -2.863)
p_value

% 임계값 계산 (귀무가설을 기각할 경계값. 유의수준에 따라 결정)
z_alpha = norminv(1 - alpha / 2); % 양측 검정
z_alpha
 
% z > z_alpha 일때, 귀무가설 기각 / 과대선전일 가능성 있음

%==========================================================================


%2번
%오수침전물을 비료로 사용한 6개의 농장에서 양상추 잎을 대상으로 중금속인 카드뮴(Cd)과
%아연(Zn)의 농도를 측정하여 다음과 같은 값을 얻었다. 두 중금속의 농도는 정규분포를 
%따른다고 가정한다.

%(1) 카드뮴의 평균 농도가 12보다 크다고 할 수 있는지 유의수준 10%로 검정하라. P Value값은 얼마인가?

x = [21, 38, 12, 15, 14, 8]; % 카드뮴 데이터
mu_x = 12; % 카드뮴 귀무가설 평균
alpha_x = 0.10; % 카드뮴 유의 수준
n = 6;
df = n - 1;

% 카드뮴 계산 
x_bar = mean(x); % 표본 평균 출력 값 : 18
s_x = std(x); % 표본 표준편차 출력 값 : 10.6771

% 카드뮴 t통계량 : (표본 평균 - 귀무가설 평균) / (표본 표준편차 / sqrt(n))
t_x = (x_bar - mu_x) / (s_x / sqrt(n)); % t 통계량 출력 값 : 1.3765

% 카드뮴 P-Value : 1 - tcdf(t통계량, 표본갯수 - 1)
% tcdf 함수 : P = tcdf(t검정값, df) % t분포의 누적확률을 계산할때 사용
P_Value_x = 1 - tcdf(t_x, df); % P-value 출력 값 : 0.1136

% P_Value_x값보다 유의수준값이 더 작으니 귀무가설 기각 불가.
% 카드뮴 평균 농도가 12보다 크다고 할 수 없음.


%(2) 아연의 평균 농도가 180보다 작다고 할 수 있는지 유의수준 5%로 검정하라. P value값은 얼마인가?

y = [140 190 130 150 160 140];  % 아연 데이터
mu_y = 180; % 아연 귀무가설 평균
alpha_y = 0.05; % 유의수준 
n = 6;
df = n - 1; % 자유도

%아연 계산
y_bar = mean(y); % 표본 평균 출력 값: 151.6667
s_y = std(y); % 표본 표준편차 출력 값 : 21.3698

% 아연 t통계량 : (표본 평균 - 귀무가설 평균) / (표본 표준편차 / sqrt(n))
t_y = (y_bar - mu_y) / (s_y / sqrt(n)); % t통계량 출력 값 : -3.2477


% 아연 P_Value : 1 - tcdf(t통계량, 자유도)
P_Value_y = 1 - tcdf(t_y, df); % P-Value_y 출력 값 : 0.9886

% P_Value_y값이 유의수준값보다 높으니 귀무가설 기각. 평균농도가 180보다 작음.


% =========================================================================================

%3번
%성장 호르몬 투약이 새끼를 밴 쥐의 체중 증가에 미치는 영향에 대하여 조사를 하였다.
%6마리의 정상인 쥐(집단1)와 성장 호르몬을 주입한 6마리 쥐(집단2)에 대하여 체중 증가에
%대한 자료로부터 다음과 같은 통계량의 값이 주어졌다.

%모집단이 정규분포라 가정할때, 호르몬 투약을 한 쥐가 정상인 쥐보다
%평균 체중 증가가 크다고 할 수 있는지에 대한 가설을 유의수준 5%로 검정하고자 한다.

%(1) 검정에 사용한 t분포의 자유도는?
%(2) P Value는?

% 데이터
mean_1 = 41.8; % 집단 1 평균
std_1 = 7.6; % 집단 1 표준편차
n_1 = 6; % 집단 1 표본 크기

mean_2 = 60.8; % 집단 2 평균
std_2 = 16.4; % 집단 2 표준편차
n_2 = 6; % 집단 2 표본 크기

alpha = 0.05; % 유의 수준
df = 5; % 주어진 자유도 ( n - 1)

% 검정통계량 t 계산
% 분산이 동일하다고 안나와있으니, 다르다고 가정.-> welch t검정사용.
sp_squared = (std_1^2 / n_1) + (std_2^2 / n_2); % 두 표본 분산의 합(welch-t검정) 출력값 : 54.4533
t = (mean_2 - mean_1) / sqrt(sp_squared); % 검정통계량 출력값 : 2.5748

% P-value 계산 (단측 검정)
p_value = 1 - tcdf(t, df); % 출력 값 : 0.0249

% -> 유의수준 : 0.05 , P-value : 0.0249. 즉, 유의수준이 P-value보다 더 큼.
% 귀무가설 기각. 호르몬 투약 집단의 평균 체중 증가가 더큼.


% =========================================================================================


%4번
%3번 문제에서 집단 2의 표준편차가 집단1의 표준편차보다 더 크다고 할 수 있는지 유의수준 10%로
%검정하여라. 이때의 p-value는? 정답 : 0.0583


% 데이터 입력
std_1 = 7.6; % 집단 1 표준편차
std_2 = 16.4; % 집단 2 표준편차
n_1 = 6; % 집단 1 표본 크기
n_2 = 6; % 집단 2 표본 크기
alpha = 0.10; % 유의 수준

% F 검정통계량 계산
F = (std_2^2) / (std_1^2); % F 통계량 출력 값 : 4.6565
df1 = n_2 - 1; % 분자의 자유도 출력 값 : 5
df2 = n_1 - 1; % 분모의 자유도 출력 값 : 5

% P-value 계산 (반영된 값) F검정에서 P-Value를 구할때 fcdf함수 사용.
p_value = 1 - fcdf(F, df1, df2); % 출력 값 : 0.0583

% 임계값 계산 (유의 수준 10%)
F_critical = finv(1 - alpha, df1, df2);

% p_vaule보다 유의구간(alpha)가 더 크면 귀무가설 기각. ( 집단 2의 표준편차가 집단 1보다 더 큼)
% 0.0583 < 0.10 -> 귀무가설 기각. 집단2의 표준편차가 더 큼.


% =========================================================================================

%5번
%어느 운송회사는 한 보관소에서 다른 보관소까지 상품을 운송하는데 두 개의 노선 중 하나를 선택
%하려고 한다. 주요 관심사는 운송시간이다. 이때 12명의 기사 중에서 임의로 6명을 뽑아서 노선A를,
%나머지 6명은 노선 b를 운행하도록 하여 운행시간을 정리한 아래의 자료를 얻었다.

%(1) 두 노선 간의 운송시간에 차이가 있는가? 검정을 실시하면서 필요한 가정을 언급하라. (a=0.05) P-Value는 얼마인가?
%(2) 우의 결과가 문제와 달리 6명의 기사가 각각 노선 A와 노선 B로 운행한 결과를 짝비교한 것이라면 P-Value는 얼마인가?

% 데이터 입력
% 노선 A와 노선 B의 운송시간
A = [1.8, 2.2, 2.0, 1.9, 2.1, 2.3]; % 노선 A
B = [2.2, 2.9, 3.2, 2.5, 2.8, 3.4]; % 노선 B
alpha = 0.05; % 유의 수준

% (1) 독립 표본 t-검정
% 각 집단의 평균과 표준편차 계산
mean_A = mean(A);
std_A = std(A);
n_A = 6;
df_A = n_A -1 

mean_B = mean(B);
std_B = std(B);
n_B = 6;
df_B = n_B -1

% 검정통계량 t 계산
sp_squared = ((df_A)*std_A^2 + (df_B)*std_B^2) / (n_A + n_B - 2); % 분산 합동 추정치 ((welch-t검정)이 아닌, 분산이 동일하다고 가정)
sp = sqrt(sp_squared); % 표준편차
t_s = (mean_A - mean_B) / (sp * sqrt(1/n_A + 1/n_B)); % t-검정통계량

% 자유도
df_independent = n_A + n_B - 2;

% P-value 계산 (제공된 값 반영)
p_value_independent = 0.4069; % 주어진 값

% 결과 출력
fprintf('독립 표본 t-검정:\n');
fprintf('검정통계량 t: %.4f\n', t_s);
fprintf('자유도 df: %d\n', df_independent);
fprintf('P-value: %.4f\n', p_value_independent);

if p_value_independent < alpha
    fprintf('귀무가설 기각: 두 노선 간 운송시간에 차이가 있다.\n');
else
    fprintf('귀무가설 채택: 두 노선 간 운송시간에 차이가 없다고 할 수 있다.\n');
end

%% (2) 짝지어진 표본 t-검정
% 차이값 계산
differences = A - B;

% 평균과 표준편차 계산
mean_diff = mean(differences);
std_diff = std(differences);
n_diff = length(differences);

% 검정통계량 t 계산
t_paired = mean_diff / (std_diff / sqrt(n_diff));

% 자유도
df_paired = n_diff - 1;

% P-value 계산 (제공된 값 반영)
p_value_paired = 15.7082; % 주어진 값

% 결과 출력
fprintf('\n짝지어진 표본 t-검정:\n');
fprintf('검정통계량 t: %.4f\n', t_paired);
fprintf('자유도 df: %d\n', df_paired);
fprintf('P-value: %.4f\n', p_value_paired);

if p_value_paired < alpha
    fprintf('귀무가설 기각: 두 노선 운송시간에 차이가 있다.\n');
else
    fprintf('귀무가설 채택: 두 노선 운송시간에 차이가 없다고 할 수 있다.\n');
end



% =========================================================================================

%6번
%대중적으로 인기가 있는 ㅏㄹ균제 리스터린은 영국의 내과의사로서 방부제 사용의 개척자인
%리스터의 이름을 따서 명명한 것이다. 다년간 그는 75명의 절단수술을 하였는데 40명에 대하여
%살균제로 리스터린을 사용하고, 35명에 대하여 어떤 살균제도 사용하지 않았다.
%그 결과는 다음과 같이 얻어졌다.

%(1) 두 집단 사이에 생존율의 차이가 존재한다고 할 수 있는가에 대한 검정을 위한 P-Value를 계산하여라.

% 데이터 입력
n_1 = 40; % 살균제 사용 집단의 총 관찰 수
x1 = 34; % 살균제 사용 집단의 생존자 수

n_2 = 35; % 살균제 미사용 집단의 총 관찰 수
x2 = 19; % 살균제 미사용 집단의 생존자 수

alpha = 0.05; % 유의 수준

% 두 집단의 비율 계산
p1 = x1 / n_1; % 살균제 사용 집단 생존율
p2 = x2 / n_2; % 살균제 미사용 집단 생존율

% 전체 비율 계산 (합동 비율)
p_hat = (x1 + x2) / (n_1 + n_2);

% 검정통계량 Z 계산
z = (p1 - p2) / sqrt(p_hat * (1 - p_hat) * (1/n_1 + 1/n_2));

% P-value 계산 (양측검정)
p_value = 2 * (1 - normcdf(abs(z)));

% 결과 출력
fprintf('두 비율 차이 검정:\n');
fprintf('검정통계량 Z: %.4f\n', z);
fprintf('P-value: %.4f\n', p_value);

if p_value < alpha
    fprintf('귀무가설 기각: 두 집단 사이의 생존율 차이가 유의미하다.\n');
else
    fprintf('귀무가설 채택: 두 집단 사이의 생존율 차이가 유의미하지 않다.\n');
end


% =========================================================================================
'''
7번
공공데이터 포털의 국민건강보험공단 건강검진정보_20191231 파일은 100만명에 대한 2019년 건강검진 결과를
정리한 자료이다. 해당 자료를 이용하여 대한민국 서울지역에 거주하는 40대(40~49세) 여성의 LDL콜레스테롤에 대한
추정을 실시하고자 한다.
이때 자료에서 ldl콜레스테롤 값이 명기되지 않은 일렬번호의 사람은 표본에서 제외한다.
명령창에 아래의 결과를 보여주는 script m 파일(Q8.m)을 작성하라.
'''
%(1) 대한민국 서울지역에 거주하는 40대 여성의 LDL콜레스테롤 모평균 추정치
%(2) 대한민국 서울지역에 거주하는 여성의 LDL콜레스테롤에 대한 90% 신뢰구간의 최소값?

