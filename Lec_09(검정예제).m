문제풀때 참고할 사항
어떤 검정통계량을 사용해야 하는지 판단하는 방법
1) 무엇을 검정하려 하는가?
-평균을 비교하는가?
-분산(표준편차)을 비교하는가?
-비율을 비교하는가?
-연속성(상관관계)을 검정하는가?

2) 데이터의 특성은 무엇인가?
-두 집단의 데이터가 독립적인가? 아니면 쌍으로 연결되어 있는가?
-데이터가 정규분포를 따르는가?
3) 가설 설정을 어떻게 하는가?
귀무가설(H0) 대립가설(H1)이 무엇인지에 따라 검정 방법이 달라짐.
예를 들어, 두 표본의 분산이 같다고 가정할지, 다를지에 따라 t-검정인지 Welch의 t-검정을 선택.

문제 상황에 따른 검정 방법
- 1.두 집단의 평균 비교 (t-검정사용) : t = (x1_bar - x2_bar) / sqrt((s1^2 / n1) + (s2^2 / n2))
(n1, n2 : 두 집단의 표본 크기 , s1,s2 : 두 집단의 표본 표준편차, x1_bar,x2_bar : 두 집단의 표본 평균)

- 2.대응표본의 평균 비교 (대응표본t-검정사용) : t = (d_bar - mu_d) / (sd / sqrt(n))
(d_bar : 차이값의 표본 평균, mu_d : 귀무가설하에서 평균 차이값(보통 0임), sd : 차이값의 표준편차, n : 차이값의 표본 크기)

- 3.두 집단의 분산 비교 (F-검정) : F = s1^2 / s2^2
(s1^2, s2^2 : 두 집단의 표본 분산)

- 4.두 집단의 비율 비교 (z-검정) : z = (p1 - p2) / sqrt(p_hat * (1 - p_hat) * (1 / n1 + 1 / n2))
(p1, p2 : 두 집단의 표본 비율, p_hat : 전체 비율((x1+x2) / (n1+n2)), n1,n2 : 두집단의 표본 크기

- 5. 하나의 분산 검정 (카이제곱 검정) : chi2 = (n - 1) * s^2 / sigma0^2
(n : 표본 크기, s^2 : 표본 분산, sigma0^2 : 귀무가설하의 모분산)

- 6. 회귀분석에서 독립 변수 검정 (t-검정) : t = (beta_hat - 0) / SE(beta_hat)
(beta_hat : 회귀 계수의 추정값, SE(beta_hat) : 회귀 계수의 표준오차)


% 실제 문제풀이는 검정통계량(t_s)와 유의수준값만 구해서 둘이 비교하면 됨. p-value값 구하라는 말 없으면 p-value안구해도됨.

% 중요!! 샘플 크기가 작을때 (n<30) tinv함수 사용 / 정확한 값 구할땐 이거 쓰기.
% tinv함수 기본 형식 : t_c = tinv(p, df);   << p는 누적확률 값 / 단측 검정(p = 1-a (유의수준),양측검정(p = 1- a/2) 유의수준/2하기 
% df : 자유도 (n-1)
% 샘플 크기가 클때 (n>30) 근사값으로 풀어도 되니 norminv함수 사용해도됨.
% 양측 검정일 때 P-value구하기 p_value = 2 * (1 - tcdf(abs(t_s), df));
% 단측 검정일 때 P-value구하기 p_value = 1 - tcdf(t_s, df);

%검정통계량 계산 (두 모집단이 모두 정규분포를 따르고 a1, a2이 다를때 검정통계량(t_s) 공식 (X는 평균, S는 표준편차)
%t_s = (X1 - X2)/ sqrt((S1^2/ N1) + (S2^2 / N2));

% =============================================================================================


% 예제 6.1: 새로운 엔진의 평균 연비가 기존 엔진(11.50 km/L)보다 높은지 검정
% (이문제는 실제 데이터가 없으니 t_stat(t통계량)과 p값을 직접 계산해야함.)
% sol1) 검정 통계량 계산식 이용 + 유의수준함수(norminv,tinv) 이용 후 비교해서 풀기 = 검정통계량이 유의수준보다 높으면 귀무가설 기각
% sol2) 아래처럼 매트랩 함수 이용해서 계산 풀이
% 실제 문제풀이는 검정통계량(t_s)와 유의수준값만 구해서 둘이 비교하면 됨. p-value값 구하라는 말 없으면 p-value안구해도됨.

% 중요!! 샘플 크기가 작을때 (n<30) tinv함수 사용 / 정확한 값 구할땐 이거 쓰기.
% tinv함수 기본 형식 : t_c = tinv(p, df);   << p는 누적확률 값 / 단측 검정(p = 1-a (유의수준),양측검정(p = 1- a/2) 유의수준/2하기 
% df : 자유도 (n-1)
% 샘플 크기가 클때 (n>30) 근사값으로 풀어도 되니 norminv함수 사용해도됨.

% 자동차를 회사에서 신규 개발 엔진을 장착할 경우 연비가 기존
% 엔진을 장착했을때의 연비인11.50 km/L 보다 높은지 검정한다.
% 신규 엔진이 장착된 차량 56대로부터 연비를 조사하였더니 평균은11.59 km/L, 표준편차는 0.28 km/L 이다. 새로운 엔진이
% 평균연비를 높인다고 할수 있는지 유의수준 1% 에서 검증하여라. 

clear all
clc

% 데이터 입력
n = 56;       % 표본 크기
mean = 11.59; % 표본 평균
std = 0.28;   % 표본 표준편차
mu_0 = 11.50;        % 비교 대상 평균
alpha = 0.01;        % 유의수준 (1%)

% 가설 설정
% 귀무가설(H0): μ <= 11.50 (평균 연비가 11.50 km/L 이하이다.)
% 대립가설(H1): μ > 11.50 (평균 연비가 11.50 km/L보다 높다.)

% t-통계량 계산 (=검정통계량(Test statstic)
t_s = (mean - mu_0) / (std / sqrt(n)); % 검정 통계량 계산식 , sqrt=루트함수
t_s % 출력 값 : 2.4054

% 자유도 계산
df = n - 1;
df % 출력 값 : 55

% 임계값 계산 (단측 검정, 오른쪽 꼬리)
t_c = tinv(1 - alpha, df);
t_c % 출력 값 : 2.3961

% p-값 계산
p_value = 1 - tcdf(t_s, df);
p_value % 출력 값 : 0.0098

% 검정통계량(t_stat)이 임계값(t_crit)보다 높으니 귀무가설 기각. 새로운 엔진의 평균 연비가 11.50km/L보다 높음
% 판단 방법
% 1) t_s(2.4054) > t_crit(2.3961)
% 2) p-value(0.0098) < 0.05 이므로 귀무가설 기각

%---------------------------------------------------------------

% 09 검정 예제 6.2
% 수질을 나타내는 하나의 수치로 단위부피당 세균수가 있는데 그 수가 200 이상이면
% 상수원으로 적합하지 않다. 호수의 10군데에서 물을 떠서 조사한 결과 단위부피당
% 세균 수는 다음과 같았다. 자료로부터 호수의 단위부피당 평균 세균수가 200미만이라고
% 주장할 수 있는지 유의수준 5%에서 검정하라. 단위부피당 세균수는 정규분포를 따른다고 가정한다.
 
% 측정된 단위부피당 세균수 : 175 190 215 198 184 207 210 193 196 180
% 200이상이면 부적합

% 가설 설정 
% 귀무가설(H_0) : u>= 200 (호수의 평균 세균 수가 200이상이다.)
% 대립가설(H_1) : u< 200 (호수의 평균 세균 수가 200미만이다.)

% help ttest 를 통해 코드 참조

clear all
clc
% 데이터 입력
x = [175 190 215 198 184 207 210 193 196 180];

% 단측 t-검정 수행
[h, p, ci, stats] = ttest (x, 200, 0.05, 'left')
% x는 데이터(표본) , 200은 귀무가설의 평균, 0.05는 유의수준, left는 검정 방향 
% 문제는 "호수의 평균 세균 수가 200 미만이라고 주장할 수 있는가?"를 검정. 그러므로 left방향

h % 출력 값 : 0. 귀무가설 기각 불가 (h는 검정 결과임. ( h=1 귀무가설 기각 , h=0 귀무가설 기각X)
p %(출력 값 : 0.1211. P값이 0.05보다 큼) ( 검정 통계량이 귀무가설 하에서 관측될 확률임. p가 유의수준 보다 작으면 가설 기각 / 크면 기각x)
ci % 출력 값 : -Inf 202.4162. (모평균 추정 구간이 200보다 클 수도 있음) (ci = 표본평균에 대한 신뢰구간.)
stats % 출력  t통계량(tstat) 출력 값 : -1.2516  자유도(df) 출력 값 : 9  표준편차(sd) 출력 값 : 13.1386

% 추가 풀이

% 중요!! 샘플 크기가 작을때 (n<30) tinv함수 사용 / 정확한 값 구할땐 이거 쓰기.
% tinv함수 기본 형식 : t_c = tinv(p, df);   << p는 누적확률 값 / 단측 검정(p = 1-a (유의수준),양측검정(p = 1- a/2) 유의수준/2하기 

ci = 0.05; % 유의수준
t_c = tinv(0.05, 9); % 단측 검정에서 왼쪽 꼬리의 임계값
t_c
% t_c= -1.8331 이니 , tstat값보다 작음. 그러므로 귀무가설 기각 불가. -> 평균 세균수가 200미만이라고 주장할
% 근거가없음.


% -------------------------------------------------------------

% 09 검정 예제 6.4
% 어느 대학의 A, B 두 학과 학생들의 토익 성적을 비교하기 위하여 표본을 추출해
% 조사한 자료가 다음과 같다. 두학과 학생들의 토익 성적 평균이 같은지 
% 유의수준 5%에서 검정하라.
% (두학과 토익성적은 서로 독립인 정규분포를 따르고 두 모집단의 표준편차는 같다고 가정)

% A학과 : 780 690 815 898 650 590
% B학과 : 536 710 693 770 780 675

% [h, p, ci, zval] = ttest(x, m, alpha, tail)
% [h, p, ci, zval] = ttest(x, y, alpha, tail)

x = [780 690 815 898 650 590];
y = [536 710 693 770 780 675];
[h, p, ci, stats] = ttest (x, y, 0.05, 'both')

% 출력시 df = 5, 자유도가 5임. (df = n-1) (o1, = o2 적용 x)
% 적용되었다면 자유도가 높아야함. ttest2 사용 필요
% h 출력 값 : 0
% p 출력 값 : 0.4967
%
% [h, p, ci, zval] = ttest2(x, y, alpha, tail) (모평균 차이 검정 / 등분산)

x = [780 690 815 898 650 590];
y = [536 710 693 770 780 675];
[h, p, ci, stats] = ttest2 (x, y, 0.05, 'both')



% ==============================================================================

% 09 검정 예제 6.5

% 학과 A의 평균 토익성적 : u1
% 학과 B의 평균 토익성적 : u2
% 가설 H0=  u1=u2 ,  H1= u=/u2
% 학과 A의 7명의 토익성적
% - 평균: 743.86, 표준편차: 105.77
% 학과 B의 7명의 토익성적
% - 평균: 677.57, 표준편차: 91.45

X1 = 743.86;
S1 = 105.77;
N1 = 7;
X2 = 677.57;
S2 = 91.45;
N2 = 7;
a = 0.05;

%검정통계량 계산 
%(두 모집단이 모두 정규분포를 따르고 a1, a2이 다를때 검정통계량(t_s) 공식 (X는 평균, S는 표준편차)
t_s = (X1 - X2)/ sqrt((S1^2/ N1) + (S2^2 / N2));

%자유도 df
df = N1 + N2 -2;

% 임계값
t_c = tinv(1 - a / 2, df);

% p-vlaue 계산 (t_c구할 수 있으면 t_c값으로 대체가능)

t_s % 1.2544
df % 12
t_c % 2.1788

% -> t_s < t_c 니까 귀무가설 기각 불가. 서로의 평균 토익 성적 차이가 유의미하지않음.(다르다고 할 수 없음.) 

% ==============================================================================

% % 예제 6.7: A와 B의 밀 생산성 비교 (대응표본 t-검정)
% 전국에서 임의로 추출한 농장 8곳에서 A와 B 종류의 밀을
% 생산한다. 각농장에서는 농장을 절반으로 나눠 A 와 B 를
% 같은면적에서 재배하였고 단위면적당 수확량의 결과는 다음과
% 같다. 밀 A의 생산성이 더 높은지 유의수준 5%에서 검정해라

% 대응표본t-검정에서는 평균, 표준편차의 차이 사용 x , 각 쌍에 대한 차이값을 구해야함.
% 대응표본t-검정은 두 집단이 쌍으로 연결되어 있음.

clear all
clc

% 농장에서 측정된 A와 B의 단위면적당 생산량
A = [23 39 19 43 33 29 28 42]; % 밀 A 생산량
B = [18 33 21 34 33 20 21 40]; % 밀 B 생산량

% 두 표본의 각 쌍에 대한 차이 
d = A - B;
d
% 대응표본 t-검정 수행
[h, p, ci, stats] = ttest(d, 0, 'Alpha', 0.05, 'Tail', 'right');
% 우변 d는 차이값 배열
% 우변 0은 귀무가설에서의 차이값
% Alpha, 0.05는 유의수준 설정
% Tail, right는 단측 검정으로 오른쪽 꼬리 결정

h  % 1이면 귀무가설 기각
p % P-Value 값
ci % 신뢰구간
stats % t통계량, 자유도 등

% h=1이니 귀무가설 기각 , A가 유의미하게 B의 생산량보다 높음

%================================================================================

% 예제 6.8: 밀 A와 밀 B의 생산성 비교 (독립표본 t-검정)
% 전국에서 임의로 추출한 농장 16곳중 8개는 밀A, 8개는 밀B 를
% 생산한다. 단위면적당 수확량의 결과는 다음과 같다. 
% 위의 말은 독립표본임. 서로 다른 농장이라는 뜻

clear all
clc

% 밀 A와 밀 B의 단위면적당 생산량 데이터
A = [23 39 19 43 33 29 28 42]; % 밀 A 생산량
B = [18 33 21 34 33 20 21 40]; % 밀 B 생산량

% 독립표본 t-검정 (등분산 가정)
% 귀무가설(H0): 밀 A의 평균 생산성이 밀 B보다 크지 않다. (μ_A <= μ_B)
% 대립가설(H1): 밀 A의 평균 생산성이 밀 B보다 크다. (μ_A > μ_B)

[h, p, ci, stats] = ttest2(A, B, 'Alpha', 0.05, 'Tail', 'right', 'Vartype', 'equal');

% 'Vartype'는 두 표본의 분산이 동일한지 여부를 설정. 
% 'Vartype', 'equal'은 두 표본의 분산이 같다고 가정 (기본값).
% 'Vartype', 'unequal': 두 표본의 분산이 다르다고 가정 (Welch의 t-검정 수행).
h
p
ci
stats

% h = 0 이니 귀무가설 기각 안함. -> 밀A의 생산성이 더 높은지 유의미하게 판단할 근거가없음.

% ================================================================================

% 한 모집단에서의 모비율 검정
% 예제 6.9: 단측 z-검정을 통한 이직률 검정
% 어느 회사의 이직률 (80명중 14명이 이직)
% 가설 : H0 : p = 0.2 vs H1 : p < 0.2

clear all
clc

% 데이터 
n = 80; % 총 샘플 수
x = 14; % 이직한 사람 수
phat = x / n; % 표본 비율
p0 = 0.2; % 귀무가설에서의 이직률
alpha = 0.05; % 유의수준

% 가설 설정
% 귀무가설(H0): p >= 0.2 (이직률이 0.2 이상이다.)
% 대립가설(H1): p < 0.2 (이직률이 0.2 미만이다.)

% z-통계량(검정통계량) 계산
z = (phat - p0) / sqrt(p0 * (1 - p0) / n);

% p-값 계산
p_value = normcdf(z);

% 임계값 계산 (단측 검정) % p값을 구할 수 있으니 이 값 안구해도 됨.
z_crit = norminv(alpha);

phat
z
p_value
z_crit

% 결과 z와 z_crit을 비교해도 되지만, p-value를 구할 수 있고,
% p-value가 0.05보다 크므로 귀무가설 채택 ! (p값으로 판별할때 0.05가 기준임.)

% 즉, 새로운 복지제도가 이직률을 낮춘다고 할 수 없다.

% ============================================================================

% 예제 6.10: 두 비율 간 차이에 대한 z-검정
% 기존공법 불량률 vs 새로운 공법 불량률 
%  두 비율이 단순히 "다른지 여부"를 검정하고 있으므로, 방향성이 없고 양측 검정이 적합

clear all
clc

% 데이터 입력
n1 = 1000; % 기존 공법 샘플 크기
x1 = 48;   % 기존 공법 불량품 수
n2 = 1500; % 신규 공법 샘플 크기
x2 = 54;   % 신규 공법 불량품 수

% 비율 계산
p1 = x1 / n1; % 기존 공법 불량률
p2 = x2 / n2; % 신규 공법 불량률
p_hat = (x1 + x2) / (n1 + n2); % 전체 불량률

% z-통계량 계산(검정통계량)
z = (p1 - p2) / sqrt(p_hat * (1 - p_hat) * (1/n1 + 1/n2)); % 암기

% 유의수준 및 임계값 설정 (양측 검정)
alpha = 0.05;
z_crit = norminv(1 - alpha / 2); % 양측 검정이므로 1-alpha/2

% p-값 계산
p_value = 2 * (1 - normcdf(abs(z))); % 양측 검정이므로 두 배

p_hat
z
z_crit
p_value
% z < z_crit 니까 귀무가설 기각X. (두 공법의 불량률에 차이가 없음.)
% P-value가 0.137 > 0.05 니까 귀무가설 채택 (두 공법의 불량률에 차이가 없음.)
% 위 두방법으로 구하면됨.

% ==============================================================================


% 예제 6.11: 단측 카이제곱 검정
% 볼트 지름의 표준편차 (10개)

% - 5. 하나의 분산 검정 (카이제곱 검정) : chi2 = (n - 1) * s^2 / sigma0^2
% (n : 표본 크기, s^2 : 표본 분산, sigma0^2 : 귀무가설하의 모분산)

clear all
clc

% 데이터 입력
n = 10; % 표본 개수
s = 0.4; % 표본 표준편차

sigma_0 = 0.2; % 귀무가설의 표준편차
alpha = 0.05; % 유의수준

% 카이제곱 검정 통계량 계산
chi2_s = (n - 1) * (s^2) / (sigma_0^2);

% 카이제곱 임계값 계산 (단측 검정, 오른쪽 꼬리)
chi2_crit = chi2inv(1 - alpha, n - 1);

% p-값 계산 (단측 검정)
p_value = 1 - chi2cdf(chi2_s, n - 1);

chi2_s
chi2_crit
p_value
% chi2_stat > chi2_crit 이면 귀무가설 기각.(더 크다고 할 수 있음.)
% p_value가 0.05보다 작으니 귀무가설 기각. 

% =============================================================================

% 예제 6.12: 밀 A와 밀 B의 모표준편차 비교 (F-검정)

std_A = 8.83; % 밀 A의 표준편차
std_B = 8.37; % 밀 B의 표준편차

n_A = 8; % 밀 A 샘플 크기
n_B = 8; % 밀 B 샘플 크기

alpha = 0.1; % 유의수준

% F-통계량 및 임계값 계산
F_stat = (std_A^2) / (std_B^2);
F_crit_upper = finv(1 - alpha/2, n_A - 1, n_B - 1);
F_crit_lower = 1 / F_crit_upper;

% 결과 해석
if F_stat < F_crit_lower || F_stat > F_crit_upper
    result = '귀무가설 기각: 모표준편차가 다릅니다.';
else
    result = '귀무가설 기각 불가: 모표준편차가 같습니다.';
end

% 결과 출력
F_stat, F_crit_lower, F_crit_upper, result
